import{r as d,i as g,j as e,ac as X,k as v,m as Y,f as E,a4 as L,S as y,x as H,u as Z,b as R,w as $,ad as ee,ae as te,a as se}from"./index-Chllbu8E.js";import{p as B}from"./purchasedProduct-CKfyrqRf.js";import{M as N}from"./Modal-QO7XjIXl.js";/* empty css                       */import{s as oe}from"./token-By_1sbaR.js";import{P as re}from"./PaginationProductos-Bk3mlEKq.js";function F(t,o){return Array.isArray(t)?t.includes(o):t===o}const w=d.createContext({});w.displayName="AccordionContext";const k=d.forwardRef(({as:t="div",bsPrefix:o,className:n,children:s,eventKey:l,...u},c)=>{const{activeEventKey:r}=d.useContext(w);return o=g(o,"accordion-collapse"),e.jsx(X,{ref:c,in:F(r,l),...u,className:v(n,o),children:e.jsx(t,{children:d.Children.only(s)})})});k.displayName="AccordionCollapse";const A=d.createContext({eventKey:""});A.displayName="AccordionItemContext";const z=d.forwardRef(({as:t="div",bsPrefix:o,className:n,onEnter:s,onEntering:l,onEntered:u,onExit:c,onExiting:r,onExited:a,...j},x)=>{o=g(o,"accordion-body");const{eventKey:i}=d.useContext(A);return e.jsx(k,{eventKey:i,onEnter:s,onEntering:l,onEntered:u,onExit:c,onExiting:r,onExited:a,children:e.jsx(t,{ref:x,...j,className:v(n,o)})})});z.displayName="AccordionBody";function ne(t,o){const{activeEventKey:n,onSelect:s,alwaysOpen:l}=d.useContext(w);return u=>{let c=t===n?null:t;l&&(Array.isArray(n)?n.includes(t)?c=n.filter(r=>r!==t):c=[...n,t]:c=[t]),s==null||s(c,u),o==null||o(u)}}const D=d.forwardRef(({as:t="button",bsPrefix:o,className:n,onClick:s,...l},u)=>{o=g(o,"accordion-button");const{eventKey:c}=d.useContext(A),r=ne(c,s),{activeEventKey:a}=d.useContext(w);return t==="button"&&(l.type="button"),e.jsx(t,{ref:u,onClick:r,...l,"aria-expanded":Array.isArray(a)?a.includes(c):c===a,className:v(n,o,!F(a,c)&&"collapsed")})});D.displayName="AccordionButton";const q=d.forwardRef(({as:t="h2",bsPrefix:o,className:n,children:s,onClick:l,...u},c)=>(o=g(o,"accordion-header"),e.jsx(t,{ref:c,...u,className:v(n,o),children:e.jsx(D,{onClick:l,children:s})})));q.displayName="AccordionHeader";const K=d.forwardRef(({as:t="div",bsPrefix:o,className:n,eventKey:s,...l},u)=>{o=g(o,"accordion-item");const c=d.useMemo(()=>({eventKey:s}),[s]);return e.jsx(A.Provider,{value:c,children:e.jsx(t,{ref:u,...l,className:v(n,o)})})});K.displayName="AccordionItem";const O=d.forwardRef((t,o)=>{const{as:n="div",activeKey:s,bsPrefix:l,className:u,onSelect:c,flush:r,alwaysOpen:a,...j}=Y(t,{activeKey:"onSelect"}),x=g(l,"accordion"),i=d.useMemo(()=>({activeEventKey:s,onSelect:c,alwaysOpen:a}),[s,c,a]);return e.jsx(w.Provider,{value:i,children:e.jsx(n,{ref:o,...j,className:v(u,x,r&&`${x}-flush`)})})});O.displayName="Accordion";const p=Object.assign(O,{Button:D,Collapse:k,Item:K,Header:q,Body:z}),G=d.forwardRef(({bsPrefix:t,className:o,striped:n,bordered:s,borderless:l,hover:u,size:c,variant:r,responsive:a,...j},x)=>{const i=g(t,"table"),S=v(o,i,r&&`${i}-${r}`,c&&`${i}-${c}`,n&&`${i}-${typeof n=="string"?`striped-${n}`:"striped"}`,s&&`${i}-bordered`,l&&`${i}-borderless`,u&&`${i}-hover`),P=e.jsx("table",{...j,className:S,ref:x});if(a){let b=`${i}-responsive`;return typeof a=="string"&&(b=`${b}-${a}`),e.jsx("div",{className:b,children:P})}return P}),ae=t=>{const[o,n]=d.useState([]),[s,l]=d.useState({fullName:t.item.clientData.fullName,email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""});d.useEffect(()=>{t.show&&(l(t.item.clientData),n(t.item.cartPurchased))},[t.show]);const u=async r=>{try{await B.update(t.item.id,{saleConfirmed:r}),y.fire({title:"Modificado correctamente!",text:`Modificaste el estado de: ${t.item.operationCode}`,icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(a=>{a.isConfirmed&&H(.5)})}catch(a){console.log(a),y.fire({title:"No se pduo modificar",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"})}},c=r=>{let a="";return r.table==="stock"?a="Stock":r.table==="primaria"?a="Primaria":r.table==="nivel_inicial"&&(a="Nivel Inicial"),a};return e.jsxs(N,{...t,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e.jsx(N.Header,{closeButton:!0,children:e.jsxs(N.Title,{id:"contained-modal-title-vcenter",children:["Detalle de operacion: ",t.item.operationCode]})}),e.jsxs(N.Body,{children:[e.jsxs(p,{children:[e.jsxs(p.Item,{eventKey:"0",children:[e.jsx(p.Header,{children:"Informacion del cliente"}),e.jsxs(p.Body,{children:[e.jsxs("div",{children:["Nombre: ",s.fullName]}),e.jsxs("div",{children:["Mail: ",s.email]}),e.jsxs("div",{children:["DNI: ",s.dni]}),e.jsxs("div",{children:["Telefono: ",s.phone]}),e.jsxs("div",{children:["Provincia: ",s.province]}),e.jsxs("div",{children:["Ciudad: ",s.city]}),e.jsxs("div",{children:["Direccion: ",s.address]}),e.jsxs("div",{children:["Codigo Postal: ",s.zipCode]}),e.jsxs("div",{children:["Metodo de pago: ",s.paymentMethod]}),e.jsxs("div",{children:["Metodo de envio: ",s.shipMethod]}),e.jsxs("div",{children:["Sucursal: ",s.sucursal!==""?s.sucursal:"ninguna"]})]})]}),e.jsxs(p.Item,{eventKey:"1",children:[e.jsx(p.Header,{children:"Informacion productos comprados"}),e.jsx(p.Body,{children:e.jsxs(G,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Talle"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"IMG"})]})}),o.map((r,a)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:r.name}),e.jsxs("td",{children:["$ ",r.discountPrice||r.discountPrice>0?r.discountPrice:r.price]}),e.jsx("td",{children:r.size}),e.jsx("td",{children:r.amountToBuy}),e.jsx("td",{children:c(r)}),e.jsx("td",{children:e.jsx("img",{src:r.img,alt:"",className:"small-img-admin"})})]})},a))]})})]}),e.jsxs(p.Item,{eventKey:"2",children:[e.jsx(p.Header,{children:"Estado comprobante"}),e.jsxs(p.Body,{children:[e.jsxs("div",{style:{padding:"10px"},children:["Estado actual:",t.item.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green",marginLeft:"10px"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red",marginLeft:"10px"}})]}),e.jsx("button",{className:"btn btn-success",onClick:()=>u(!0),style:{marginRight:"10px"},children:"Confirmar que se subio el comprobante"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>u(!1),children:"Indicar que no se subio el comprobante"})]})]})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total:"})," $",E(t.item.totalPricePurchased||0)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",t.item.time]})]})]}),e.jsx(N.Footer,{children:e.jsx(L,{variant:"secondary",onClick:t.onHide,children:"Cerrar"})})]})};var ce=ie;function ie(t,o,n){var s=null,l=null,u=function(){s&&(clearTimeout(s),l=null,s=null)},c=function(){var a=l;u(),a&&a()},r=function(){if(!o)return t.apply(this,arguments);var a=this,j=arguments,x=n&&!s;if(u(),l=function(){t.apply(a,j)},s=setTimeout(function(){if(s=null,!x){var i=l;return l=null,i()}},o),x)return l()};return r.cancel=u,r.flush=c,r}const le=({purchasedProducts:t,setPurchasedProducts:o,everyProductsRef:n,onPageChange:s})=>{const l=Z();R(x=>x.filter.search.toLowerCase());const[u,c]=d.useState(""),r=d.useCallback(ce(x=>{x!==""?(console.log(n),console.log(n.filter(i=>i.operationCode.toLowerCase().includes(x.toLowerCase())||i.clientData.fullName.toLowerCase().includes(x.toLowerCase())||i.time.toLowerCase().includes(x.toLowerCase()))),o(n.filter(i=>i.operationCode.toLowerCase().includes(x.toLowerCase())||i.clientData.fullName.toLowerCase().includes(x.toLowerCase())||i.time.toLowerCase().includes(x.toLowerCase()))),s(1)):j()},400),[]),a=x=>{const i=x.target.value;i.startsWith(" ")||(c(i),l(te(i)),r(i))},j=async()=>{o(await B.getAll())};return e.jsxs($,{className:"d-flex",fixed:"right",style:{marginLeft:"auto",flexDirection:"column"},children:[e.jsxs("div",{className:"d-flex",style:{},children:[e.jsx($.Control,{type:"search",placeholder:"buscar por codigo, cliente, fecha...",className:"me-2","aria-label":"Search",onChange:a,value:u}),e.jsx(L,{onClick:()=>j(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(ee,{width:"18px",height:"18px"})})]}),e.jsxs("label",{style:{fontSize:"14px",padding:"3px"},children:[t==null?void 0:t.length," resultados de ",n.length]})]})},je=()=>{var T;const t=R(h=>h.login),o=se(),[n,s]=d.useState([]),l=d.useRef([]),[u,c]=d.useState(!1),[r,a]=d.useState({clientData:{fullName:"",email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""}}),[j,x]=d.useState(1),i=8,S=n.length,P=Math.ceil(S/i);d.useEffect(()=>{(async()=>{const f=await B.getAll(),m=_(f);s(m),l.current=m})()},[]);const b=h=>{c(!0),a(h)},I=h=>{x(h)},V=()=>{const h=(j-1)*i,f=h+i;return n.slice(h,f)},W=h=>{y.fire({title:"Estas segura que queres eliminar el registro?",text:`codigo de operacion: ${h.operationCode}`,icon:"question",confirmButtonText:"Aceptar",confirmButtonColor:"#000",showDenyButton:!0,denyButtonText:"Cancelar"}).then(async f=>{if(f.isConfirmed)try{const m=oe(t.token);await B.deletePurchase(h.id,m),y.fire({title:"Eliminado correctamente!",icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(()=>{H(.5)})}catch(m){console.error("Error",m),m.response.data.error==="token expired"?y.fire({title:"Se cerro tu sesion!",text:"Deberas iniciar sesion nuevamente",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(C=>{C.isConfirmed&&o("/login")}):(console.log(m),y.fire({title:"Error inesperado",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}))}})},M=h=>{const f=h.replace(/\s+/g," ").replace(/ a\. m\./i,"AM").replace(/ p\. m\./i,"PM"),[m]=f.split(", "),[C,J,Q]=m.split("/").map(Number);return new Date(Q,J-1,C)},_=(h,f)=>h.sort((m,C)=>M(C.time)-M(m.time)),U=h=>{let f=0,m=0;return h.cartPurchased.map(C=>{C.table=="primaria"?f++:C.table=="nivel_inicial"&&m++}),f==0&&m==0};return e.jsx("div",{children:e.jsxs("div",{className:"contenedor-tablas-productos",children:[e.jsx("h3",{children:"Historial de ventas"}),e.jsxs("div",{className:"d-flex gap-2 w-100",style:{marginLeft:"7%",alignItems:"center",marginBottom:"20px"},children:[e.jsx("div",{style:{backgroundColor:"#eed6e5",width:"40px",height:"20px",borderRadius:"8px"}}),e.jsx("p",{style:{fontSize:"13px",margin:"0px"},children:"Guardapolvos comprados del stock"})]}),e.jsxs("div",{className:"filters-table-container",children:[e.jsx(le,{purchasedProducts:n,setPurchasedProducts:s,everyProductsRef:l.current,onPageChange:I}),e.jsx("div",{className:"contenedor-tabla",children:e.jsxs(G,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{className:"hide-on-mobile",children:"Codigo de operacion"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Total Compra"}),e.jsx("th",{className:"hide-on-mobile",children:"Fecha de compra"}),e.jsx("th",{children:"Comprobante"}),e.jsx("th",{children:"*"}),e.jsx("th",{children:"*"})]})}),(T=V())==null?void 0:T.map((h,f)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",style:U(h)?{backgroundColor:"#fbe6f3"}:null,children:[e.jsx("td",{children:f+1}),e.jsx("td",{className:"hide-on-mobile",children:h.operationCode}),e.jsx("td",{children:h.clientData.fullName}),e.jsxs("td",{children:["$ ",E(h.totalPricePurchased)]}),e.jsx("td",{className:"hide-on-mobile",children:h.time}),e.jsx("td",{children:h.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red"}})}),e.jsx("td",{onClick:()=>b(h),style:{cursor:"pointer",textDecoration:"underline"},children:"ver detalle"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>W(h),className:"boton-eliminar",style:{backgroundColor:"transparent"},children:e.jsx("i",{className:"fas fa-trash-alt"})})})]})},f))]})}),e.jsx(re,{currentPage:j,totalPages:P,onPageChange:I})]}),e.jsx(ae,{item:r,show:u,onHide:()=>c(!1)})]})})};export{je as default};
