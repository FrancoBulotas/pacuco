import{r as c,t as C,j as e,aa as J,v,K as W,ab as T,E as k,S as y,J as R,u as Z,b as H,F as E,ac as Q,ad as X,Z as Y,ae as L,a as ee}from"./index-hLMJA6t8.js";import{p as A}from"./purchasedProduct-Dau4T2OP.js";import{M as N}from"./Modal-CCC26KiS.js";/* empty css                       */import{s as te}from"./token-By_1sbaR.js";import{P as se}from"./PaginationProductos-G7JCcgrr.js";function F(t,o){return Array.isArray(t)?t.includes(o):t===o}const w=c.createContext({});w.displayName="AccordionContext";const I=c.forwardRef(({as:t="div",bsPrefix:o,className:n,children:r,eventKey:d,...i},a)=>{const{activeEventKey:x}=c.useContext(w);return o=C(o,"accordion-collapse"),e.jsx(J,{ref:a,in:F(x,d),...i,className:v(n,o),children:e.jsx(t,{children:c.Children.only(r)})})});I.displayName="AccordionCollapse";const S=c.createContext({eventKey:""});S.displayName="AccordionItemContext";const z=c.forwardRef(({as:t="div",bsPrefix:o,className:n,onEnter:r,onEntering:d,onEntered:i,onExit:a,onExiting:x,onExited:s,...u},m)=>{o=C(o,"accordion-body");const{eventKey:l}=c.useContext(S);return e.jsx(I,{eventKey:l,onEnter:r,onEntering:d,onEntered:i,onExit:a,onExiting:x,onExited:s,children:e.jsx(t,{ref:m,...u,className:v(n,o)})})});z.displayName="AccordionBody";function oe(t,o){const{activeEventKey:n,onSelect:r,alwaysOpen:d}=c.useContext(w);return i=>{let a=t===n?null:t;d&&(Array.isArray(n)?n.includes(t)?a=n.filter(x=>x!==t):a=[...n,t]:a=[t]),r==null||r(a,i),o==null||o(i)}}const M=c.forwardRef(({as:t="button",bsPrefix:o,className:n,onClick:r,...d},i)=>{o=C(o,"accordion-button");const{eventKey:a}=c.useContext(S),x=oe(a,r),{activeEventKey:s}=c.useContext(w);return t==="button"&&(d.type="button"),e.jsx(t,{ref:i,onClick:x,...d,"aria-expanded":Array.isArray(s)?s.includes(a):a===s,className:v(n,o,!F(s,a)&&"collapsed")})});M.displayName="AccordionButton";const K=c.forwardRef(({as:t="h2",bsPrefix:o,className:n,children:r,onClick:d,...i},a)=>(o=C(o,"accordion-header"),e.jsx(t,{ref:a,...i,className:v(n,o),children:e.jsx(M,{onClick:d,children:r})})));K.displayName="AccordionHeader";const q=c.forwardRef(({as:t="div",bsPrefix:o,className:n,eventKey:r,...d},i)=>{o=C(o,"accordion-item");const a=c.useMemo(()=>({eventKey:r}),[r]);return e.jsx(S.Provider,{value:a,children:e.jsx(t,{ref:i,...d,className:v(n,o)})})});q.displayName="AccordionItem";const O=c.forwardRef((t,o)=>{const{as:n="div",activeKey:r,bsPrefix:d,className:i,onSelect:a,flush:x,alwaysOpen:s,...u}=W(t,{activeKey:"onSelect"}),m=C(d,"accordion"),l=c.useMemo(()=>({activeEventKey:r,onSelect:a,alwaysOpen:s}),[r,a,s]);return e.jsx(w.Provider,{value:l,children:e.jsx(n,{ref:o,...u,className:v(i,m,x&&`${m}-flush`)})})});O.displayName="Accordion";const p=Object.assign(O,{Button:M,Collapse:I,Item:q,Header:K,Body:z}),G=c.forwardRef(({bsPrefix:t,className:o,striped:n,bordered:r,borderless:d,hover:i,size:a,variant:x,responsive:s,...u},m)=>{const l=C(t,"table"),g=v(o,l,x&&`${l}-${x}`,a&&`${l}-${a}`,n&&`${l}-${typeof n=="string"?`striped-${n}`:"striped"}`,r&&`${l}-bordered`,d&&`${l}-borderless`,i&&`${l}-hover`),B=e.jsx("table",{...u,className:g,ref:m});if(s){let b=`${l}-responsive`;return typeof s=="string"&&(b=`${b}-${s}`),e.jsx("div",{className:b,children:B})}return B}),re=t=>{const[o,n]=c.useState([]),[r,d]=c.useState({fullName:t.item.clientData.fullName,email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""});c.useEffect(()=>{t.show&&(d(t.item.clientData),n(t.item.cartPurchased))},[t.show]);const i=async s=>{try{await A.update(t.item.id,{saleConfirmed:s}),y.fire({title:"Modificado correctamente!",text:`Modificaste el estado de: ${t.item.operationCode}`,icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(u=>{u.isConfirmed&&R(.5)})}catch(u){console.log(u),y.fire({title:"No se pduo modificar",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"})}},a=s=>{let u="";return s.table==="stock"?u="Stock":s.table==="primaria"?u="Primaria":s.table==="nivel_inicial"&&(u="Nivel Inicial"),u},x=s=>{y.fire({imageUrl:s,showConfirmButton:!1})};return e.jsxs(N,{...t,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e.jsx(N.Header,{closeButton:!0,children:e.jsxs(N.Title,{id:"contained-modal-title-vcenter",children:["Detalle de operacion: ",t.item.operationCode]})}),e.jsxs(N.Body,{children:[e.jsxs(p,{children:[e.jsxs(p.Item,{eventKey:"0",children:[e.jsx(p.Header,{children:"Informacion del cliente"}),e.jsxs(p.Body,{children:[e.jsxs("div",{children:["Nombre: ",r.fullName]}),e.jsxs("div",{children:["Mail: ",r.email]}),e.jsxs("div",{children:["DNI: ",r.dni]}),e.jsxs("div",{children:["Telefono: ",r.phone]}),e.jsxs("div",{children:["Provincia: ",r.province]}),e.jsxs("div",{children:["Ciudad: ",r.city]}),e.jsxs("div",{children:["Direccion: ",r.address]}),e.jsxs("div",{children:["Codigo Postal: ",r.zipCode]}),e.jsxs("div",{children:["Metodo de pago: ",r.paymentMethod]}),e.jsxs("div",{children:["Metodo de envio: ",r.shipMethod]}),e.jsxs("div",{children:["Sucursal: ",r.sucursal!==""?r.sucursal:"ninguna"]})]})]}),e.jsxs(p.Item,{eventKey:"1",children:[e.jsx(p.Header,{children:"Informacion productos comprados"}),e.jsx(p.Body,{children:e.jsxs(G,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Talle"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"IMG"})]})}),o.map((s,u)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("td",{children:u+1}),e.jsx("td",{children:s.name}),e.jsxs("td",{children:["$ ",s.discountPrice||s.discountPrice>0?s.discountPrice:s.price]}),e.jsx("td",{children:s.size}),e.jsx("td",{children:s.amountToBuy}),e.jsx("td",{children:a(s)}),e.jsx("td",{children:e.jsx("img",{src:s.img,onClick:()=>x(s.img),alt:s.description.general,className:"small-img-admin",style:{cursor:"pointer"}})})]})},u))]})})]}),e.jsxs(p.Item,{eventKey:"2",children:[e.jsx(p.Header,{children:"Estado comprobante"}),e.jsxs(p.Body,{children:[e.jsxs("div",{style:{padding:"10px"},children:["Estado actual:",t.item.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green",marginLeft:"10px"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red",marginLeft:"10px"}})]}),e.jsx("button",{className:"btn btn-success",onClick:()=>i(!0),style:{marginRight:"10px"},children:"Confirmar que se subio el comprobante"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>i(!1),children:"Indicar que no se subio el comprobante"})]})]})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total:"})," $",T(t.item.totalPricePurchased||0)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",t.item.time]})]})]}),e.jsx(N.Footer,{children:e.jsx(k,{variant:"secondary",onClick:t.onHide,children:"Cerrar"})})]})},ne=({purchasedProducts:t,setPurchasedProducts:o,everyProductsRef:n,onPageChange:r})=>{const d=Z(),i=H(l=>l.filter.search.toLowerCase()),[a,x]=c.useState(""),s=l=>{const g=l.target.value;g.startsWith(" ")||(x(g),d(Y(g)))},u=async()=>{i!==""?(o(n.filter(l=>l.operationCode.toLowerCase().includes(i.toLowerCase())||l.clientData.fullName.toLowerCase().includes(i.toLowerCase())||l.time.toLowerCase().includes(i.toLowerCase()))),r(1)):m()},m=async()=>{x(""),o(L(await A.getAll()))};return e.jsxs(E,{className:"d-flex",fixed:"right",style:{marginLeft:"auto",flexDirection:"column"},children:[e.jsxs("div",{className:"d-flex",style:{},children:[e.jsx(E.Control,{type:"search",placeholder:"buscar por codigo, cliente, fecha...",className:"me-2","aria-label":"Search",onChange:s,value:a}),e.jsx(k,{onClick:()=>u(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(Q,{})}),e.jsx(k,{onClick:()=>m(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(X,{width:"18px",height:"18px"})})]}),e.jsxs("label",{style:{fontSize:"14px",padding:"3px"},children:[t==null?void 0:t.length," resultados de ",n.length]})]})},ue=()=>{var D;const t=H(h=>h.login),o=ee(),[n,r]=c.useState([]),d=c.useRef([]),[i,a]=c.useState(!1),[x,s]=c.useState({clientData:{fullName:"",email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""}}),[u,m]=c.useState(1),l=7,g=n.length,B=Math.ceil(g/l);c.useEffect(()=>{(async()=>{const f=await A.getAll(),j=L(f);r(j),d.current=j})()},[]);const b=h=>{a(!0),s(h)},$=h=>{m(h)},U=()=>{const h=(u-1)*l,f=h+l;return n.slice(h,f)},V=h=>{y.fire({title:"Estas segura que queres eliminar el registro?",text:`codigo de operacion: ${h.operationCode}`,icon:"question",confirmButtonText:"Aceptar",confirmButtonColor:"#000",showDenyButton:!0,denyButtonText:"Cancelar"}).then(async f=>{if(f.isConfirmed)try{const j=te(t.token);await A.deletePurchase(h.id,j),y.fire({title:"Eliminado correctamente!",icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(()=>{R(.5)})}catch(j){console.error("Error",j),j.response.data.error==="token expired"?y.fire({title:"Se cerro tu sesion!",text:"Deberas iniciar sesion nuevamente",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(P=>{P.isConfirmed&&o("/login")}):(console.log(j),y.fire({title:"Error inesperado",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}))}})},_=h=>{let f=0,j=0;return h.cartPurchased.map(P=>{P.table=="primaria"?f++:P.table=="nivel_inicial"&&j++}),f==0&&j==0};return e.jsx("div",{children:e.jsxs("div",{className:"contenedor-tablas-productos",children:[e.jsx("h3",{children:"Historial de ventas"}),e.jsxs("div",{className:"d-flex gap-2 w-100",style:{marginLeft:"7%",alignItems:"center",marginBottom:"20px"},children:[e.jsx("div",{style:{backgroundColor:"#eed6e5",width:"40px",height:"20px",borderRadius:"8px"}}),e.jsx("p",{style:{fontSize:"13px",margin:"0px"},children:"Guardapolvos comprados del stock"})]}),e.jsxs("div",{className:"filters-table-container",children:[e.jsx(ne,{purchasedProducts:n,setPurchasedProducts:r,everyProductsRef:d.current,onPageChange:$}),e.jsx("div",{className:"contenedor-tabla",children:e.jsxs(G,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{className:"hide-on-mobile",children:"Codigo de operacion"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{className:"hide-on-mobile",children:"Total Compra"}),e.jsx("th",{children:"Fecha de compra"}),e.jsx("th",{children:"Comprobante"}),e.jsx("th",{children:"*"}),e.jsx("th",{children:"*"})]})}),(D=U())==null?void 0:D.map((h,f)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",style:_(h)?{backgroundColor:"#fbe6f3"}:null,children:[e.jsx("td",{children:f+1}),e.jsx("td",{className:"hide-on-mobile",children:h.operationCode}),e.jsx("td",{children:h.clientData.fullName}),e.jsxs("td",{className:"hide-on-mobile",children:["$ ",T(h.totalPricePurchased)]}),e.jsx("td",{children:h.time.split(",")[0]}),e.jsx("td",{children:h.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red"}})}),e.jsx("td",{onClick:()=>b(h),style:{cursor:"pointer",textDecoration:"underline"},children:"ver detalle"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>V(h),className:"boton-eliminar",style:{backgroundColor:"transparent"},children:e.jsx("i",{className:"fas fa-trash-alt"})})})]})},f))]})}),e.jsx(se,{currentPage:u,totalPages:B,onPageChange:$})]}),e.jsx(re,{item:x,show:i,onHide:()=>a(!1)})]})})};export{ue as default};
