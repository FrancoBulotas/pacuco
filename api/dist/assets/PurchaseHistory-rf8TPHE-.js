import{r as h,q as L,t as A,j as e,aa as m,ab as S,E as T,S as p,J as D,u as H,D as M,F as B,ac as F,Z as q,b as R}from"./index-DpRaKJ3k.js";import{p as y}from"./purchasedProduct-tpxE5EXA.js";import{M as v}from"./Modal-HJmpiUsf.js";/* empty css                       */import{s as z}from"./token-By_1sbaR.js";import{P as K}from"./PaginationProductos-CZeEL6jE.js";const k=h.forwardRef(({bsPrefix:r,className:u,striped:l,bordered:t,borderless:i,hover:d,size:x,variant:s,responsive:a,...f},c)=>{const n=L(r,"table"),N=A(u,n,s&&`${n}-${s}`,x&&`${n}-${x}`,l&&`${n}-${typeof l=="string"?`striped-${l}`:"striped"}`,t&&`${n}-bordered`,i&&`${n}-borderless`,d&&`${n}-hover`),C=e.jsx("table",{...f,className:N,ref:c});if(a){let g=`${n}-responsive`;return typeof a=="string"&&(g=`${g}-${a}`),e.jsx("div",{className:g,children:C})}return C}),W=r=>{const[u,l]=h.useState([]),[t,i]=h.useState({fullName:r.item.clientData.fullName,email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""});h.useEffect(()=>{r.show&&(i(r.item.clientData),l(r.item.cartPurchased))},[r.show]);const d=async s=>{try{await y.update(r.item.id,{saleConfirmed:s}),p.fire({title:"Modificado correctamente!",text:`Modificaste el estado de: ${r.item.operationCode}`,icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(a=>{a.isConfirmed&&D(.5)})}catch(a){console.log(a),p.fire({title:"No se pduo modificar",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"})}},x=s=>{let a="";return s.table==="stock"?a="Stock":s.table==="primaria"?a="Primaria":s.table==="nivel_inicial"&&(a="Nivel Inicial"),a};return e.jsxs(v,{...r,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e.jsx(v.Header,{closeButton:!0,children:e.jsxs(v.Title,{id:"contained-modal-title-vcenter",children:["Detalle de operacion: ",r.item.operationCode]})}),e.jsxs(v.Body,{children:[e.jsxs(m,{children:[e.jsxs(m.Item,{eventKey:"0",children:[e.jsx(m.Header,{children:"Informacion del cliente"}),e.jsxs(m.Body,{children:[e.jsxs("div",{children:["Nombre: ",t.fullName]}),e.jsxs("div",{children:["Mail: ",t.email]}),e.jsxs("div",{children:["DNI: ",t.dni]}),e.jsxs("div",{children:["Telefono: ",t.phone]}),e.jsxs("div",{children:["Provincia: ",t.province]}),e.jsxs("div",{children:["Ciudad: ",t.city]}),e.jsxs("div",{children:["Direccion: ",t.address]}),e.jsxs("div",{children:["Codigo Postal: ",t.zipCode]}),e.jsxs("div",{children:["Metodo de pago: ",t.paymentMethod]}),e.jsxs("div",{children:["Metodo de envio: ",t.shipMethod]}),e.jsxs("div",{children:["Sucursal: ",t.sucursal!==""?t.sucursal:"ninguna"]})]})]}),e.jsxs(m.Item,{eventKey:"1",children:[e.jsx(m.Header,{children:"Informacion productos comprados"}),e.jsx(m.Body,{children:e.jsxs(k,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Talle"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"IMG"})]})}),u.map((s,a)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:s.name}),e.jsxs("td",{children:["$ ",s.discountPrice||s.discountPrice>0?s.discountPrice:s.price]}),e.jsx("td",{children:s.size}),e.jsx("td",{children:s.amountToBuy}),e.jsx("td",{children:x(s)}),e.jsx("td",{children:e.jsx("img",{src:s.img,alt:"",className:"small-img-admin"})})]})},a))]})})]}),e.jsxs(m.Item,{eventKey:"2",children:[e.jsx(m.Header,{children:"Estado comprobante"}),e.jsxs(m.Body,{children:[e.jsxs("div",{style:{padding:"10px"},children:["Estado actual:",r.item.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green",marginLeft:"10px"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red",marginLeft:"10px"}})]}),e.jsx("button",{className:"btn btn-success",onClick:()=>d(!0),style:{marginRight:"10px"},children:"Confirmar que se subio el comprobante"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>d(!1),children:"Indicar que no se subio el comprobante"})]})]})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total:"})," $",S(r.item.totalPricePurchased||0)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",r.item.time]})]})]}),e.jsx(v.Footer,{children:e.jsx(T,{variant:"secondary",onClick:r.onHide,children:"Cerrar"})})]})};var G=J;function J(r,u,l){var t=null,i=null,d=function(){t&&(clearTimeout(t),i=null,t=null)},x=function(){var a=i;d(),a&&a()},s=function(){if(!u)return r.apply(this,arguments);var a=this,f=arguments,c=l&&!t;if(d(),i=function(){r.apply(a,f)},t=setTimeout(function(){if(t=null,!c){var n=i;return i=null,n()}},u),c)return i()};return s.cancel=d,s.flush=x,s}const Z=({purchasedProducts:r,setPurchasedProducts:u,everyProductsRef:l,onPageChange:t})=>{const i=H();M(c=>c.filter.search.toLowerCase());const[d,x]=h.useState(""),s=h.useCallback(G(c=>{c!==""?(u(l.filter(n=>n.operationCode.toLowerCase().includes(c.toLowerCase())||n.clientData.fullName.toLowerCase().includes(c.toLowerCase())||n.time.toLowerCase().includes(c.toLowerCase()))),t(1)):f()},400),[]),a=c=>{const n=c.target.value;n.startsWith(" ")||(x(n),i(q(n)),s(n))},f=async()=>{u(await y.getAll())};return e.jsxs(B,{className:"d-flex",fixed:"right",style:{marginLeft:"auto",flexDirection:"column"},children:[e.jsxs("div",{className:"d-flex",style:{},children:[e.jsx(B.Control,{type:"search",placeholder:"buscar por codigo, cliente, fecha...",className:"me-2","aria-label":"Search",onChange:a,value:d}),e.jsx(T,{onClick:()=>f(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(F,{width:"18px",height:"18px"})})]}),e.jsxs("label",{style:{fontSize:"14px",padding:"3px"},children:[r==null?void 0:r.length," resultados de ",l.length]})]})},Y=()=>{var w;const r=M(o=>o.login),u=R(),[l,t]=h.useState([]),i=h.useRef([]),[d,x]=h.useState(!1),[s,a]=h.useState({clientData:{fullName:"",email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""}}),[f,c]=h.useState(1),n=7,N=l.length,C=Math.ceil(N/n);h.useEffect(()=>{(async()=>{const j=await y.getAll();t(j),i.current=j})()},[]);const g=o=>{x(!0),a(o)},P=o=>{c(o)},$=()=>{const o=(f-1)*n,j=o+n;return l.slice(o,j)},I=o=>{p.fire({title:"Estas segura que queres eliminar el registro?",text:`codigo de operacion: ${o.operationCode}`,icon:"question",confirmButtonText:"Aceptar",confirmButtonColor:"#000",showDenyButton:!0,denyButtonText:"Cancelar"}).then(async j=>{if(j.isConfirmed)try{const b=z(r.token);await y.deletePurchase(o.id,b),p.fire({title:"Eliminado correctamente!",icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(()=>{D(.5)})}catch(b){console.error("Error",b),b.response.data.error==="token expired"?p.fire({title:"Se cerro tu sesion!",text:"Deberas iniciar sesion nuevamente",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(E=>{E.isConfirmed&&u("/login")}):(console.log(b),p.fire({title:"Error inesperado",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}))}})};return e.jsx("div",{children:e.jsxs("div",{className:"contenedor-tablas-productos",children:[e.jsx("h3",{children:"Historial de ventas"}),e.jsxs("div",{className:"filters-table-container",children:[e.jsx(Z,{purchasedProducts:l,setPurchasedProducts:t,everyProductsRef:i.current,onPageChange:P}),e.jsx("div",{className:"contenedor-tabla",children:e.jsxs(k,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Codigo de operacion"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Total Compra"}),e.jsx("th",{children:"Fecha de compra"}),e.jsx("th",{children:"Comprobante"}),e.jsx("th",{children:"*"}),e.jsx("th",{children:"*"})]})}),(w=$())==null?void 0:w.map((o,j)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("td",{children:j+1}),e.jsx("td",{children:o.operationCode}),e.jsx("td",{children:o.clientData.fullName}),e.jsxs("td",{children:["$ ",S(o.totalPricePurchased)]}),e.jsx("td",{children:o.time}),e.jsx("td",{children:o.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red"}})}),e.jsx("td",{onClick:()=>g(o),style:{cursor:"pointer",textDecoration:"underline"},children:"ver detalle"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>I(o),className:"boton-eliminar",style:{backgroundColor:"transparent"},children:e.jsx("i",{className:"fas fa-trash-alt"})})})]})},j))]})}),e.jsx(K,{currentPage:f,totalPages:C,onPageChange:P})]}),e.jsx(W,{item:s,show:d,onHide:()=>x(!1)})]})})};export{Y as default};
