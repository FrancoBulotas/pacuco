import{r as l,i as C,j as e,ac as X,k as v,m as Y,f as R,a4 as k,S as b,x as H,u as Z,b as L,w as E,ad as ee,ae as te,af as se,a as oe}from"./index-DmDCZiuf.js";import{p as A}from"./purchasedProduct-CcC7u4kU.js";import{M as w}from"./Modal-D4Kn3oS3.js";/* empty css                       */import{s as re}from"./token-By_1sbaR.js";import{P as ne}from"./PaginationProductos-CJnvgHj3.js";function z(t,s){return Array.isArray(t)?t.includes(s):t===s}const P=l.createContext({});P.displayName="AccordionContext";const I=l.forwardRef(({as:t="div",bsPrefix:s,className:n,children:o,eventKey:u,...d},a)=>{const{activeEventKey:r}=l.useContext(P);return s=C(s,"accordion-collapse"),e.jsx(X,{ref:a,in:z(r,u),...d,className:v(n,s),children:e.jsx(t,{children:l.Children.only(o)})})});I.displayName="AccordionCollapse";const S=l.createContext({eventKey:""});S.displayName="AccordionItemContext";const F=l.forwardRef(({as:t="div",bsPrefix:s,className:n,onEnter:o,onEntering:u,onEntered:d,onExit:a,onExiting:r,onExited:c,...j},f)=>{s=C(s,"accordion-body");const{eventKey:h}=l.useContext(S);return e.jsx(I,{eventKey:h,onEnter:o,onEntering:u,onEntered:d,onExit:a,onExiting:r,onExited:c,children:e.jsx(t,{ref:f,...j,className:v(n,s)})})});F.displayName="AccordionBody";function ae(t,s){const{activeEventKey:n,onSelect:o,alwaysOpen:u}=l.useContext(P);return d=>{let a=t===n?null:t;u&&(Array.isArray(n)?n.includes(t)?a=n.filter(r=>r!==t):a=[...n,t]:a=[t]),o==null||o(a,d),s==null||s(d)}}const M=l.forwardRef(({as:t="button",bsPrefix:s,className:n,onClick:o,...u},d)=>{s=C(s,"accordion-button");const{eventKey:a}=l.useContext(S),r=ae(a,o),{activeEventKey:c}=l.useContext(P);return t==="button"&&(u.type="button"),e.jsx(t,{ref:d,onClick:r,...u,"aria-expanded":Array.isArray(c)?c.includes(a):a===c,className:v(n,s,!z(c,a)&&"collapsed")})});M.displayName="AccordionButton";const q=l.forwardRef(({as:t="h2",bsPrefix:s,className:n,children:o,onClick:u,...d},a)=>(s=C(s,"accordion-header"),e.jsx(t,{ref:a,...d,className:v(n,s),children:e.jsx(M,{onClick:u,children:o})})));q.displayName="AccordionHeader";const K=l.forwardRef(({as:t="div",bsPrefix:s,className:n,eventKey:o,...u},d)=>{s=C(s,"accordion-item");const a=l.useMemo(()=>({eventKey:o}),[o]);return e.jsx(S.Provider,{value:a,children:e.jsx(t,{ref:d,...u,className:v(n,s)})})});K.displayName="AccordionItem";const O=l.forwardRef((t,s)=>{const{as:n="div",activeKey:o,bsPrefix:u,className:d,onSelect:a,flush:r,alwaysOpen:c,...j}=Y(t,{activeKey:"onSelect"}),f=C(u,"accordion"),h=l.useMemo(()=>({activeEventKey:o,onSelect:a,alwaysOpen:c}),[o,a,c]);return e.jsx(P.Provider,{value:h,children:e.jsx(n,{ref:s,...j,className:v(d,f,r&&`${f}-flush`)})})});O.displayName="Accordion";const p=Object.assign(O,{Button:M,Collapse:I,Item:K,Header:q,Body:F}),G=l.forwardRef(({bsPrefix:t,className:s,striped:n,bordered:o,borderless:u,hover:d,size:a,variant:r,responsive:c,...j},f)=>{const h=C(t,"table"),g=v(s,h,r&&`${h}-${r}`,a&&`${h}-${a}`,n&&`${h}-${typeof n=="string"?`striped-${n}`:"striped"}`,o&&`${h}-bordered`,u&&`${h}-borderless`,d&&`${h}-hover`),B=e.jsx("table",{...j,className:g,ref:f});if(c){let N=`${h}-responsive`;return typeof c=="string"&&(N=`${N}-${c}`),e.jsx("div",{className:N,children:B})}return B}),ce=t=>{const[s,n]=l.useState([]),[o,u]=l.useState({fullName:t.item.clientData.fullName,email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""});l.useEffect(()=>{t.show&&(u(t.item.clientData),n(t.item.cartPurchased))},[t.show]);const d=async r=>{try{await A.update(t.item.id,{saleConfirmed:r}),b.fire({title:"Modificado correctamente!",text:`Modificaste el estado de: ${t.item.operationCode}`,icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(c=>{c.isConfirmed&&H(.5)})}catch(c){console.log(c),b.fire({title:"No se pduo modificar",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"})}},a=r=>{let c="";return r.table==="stock"?c="Stock":r.table==="primaria"?c="Primaria":r.table==="nivel_inicial"&&(c="Nivel Inicial"),c};return e.jsxs(w,{...t,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e.jsx(w.Header,{closeButton:!0,children:e.jsxs(w.Title,{id:"contained-modal-title-vcenter",children:["Detalle de operacion: ",t.item.operationCode]})}),e.jsxs(w.Body,{children:[e.jsxs(p,{children:[e.jsxs(p.Item,{eventKey:"0",children:[e.jsx(p.Header,{children:"Informacion del cliente"}),e.jsxs(p.Body,{children:[e.jsxs("div",{children:["Nombre: ",o.fullName]}),e.jsxs("div",{children:["Mail: ",o.email]}),e.jsxs("div",{children:["DNI: ",o.dni]}),e.jsxs("div",{children:["Telefono: ",o.phone]}),e.jsxs("div",{children:["Provincia: ",o.province]}),e.jsxs("div",{children:["Ciudad: ",o.city]}),e.jsxs("div",{children:["Direccion: ",o.address]}),e.jsxs("div",{children:["Codigo Postal: ",o.zipCode]}),e.jsxs("div",{children:["Metodo de pago: ",o.paymentMethod]}),e.jsxs("div",{children:["Metodo de envio: ",o.shipMethod]}),e.jsxs("div",{children:["Sucursal: ",o.sucursal!==""?o.sucursal:"ninguna"]})]})]}),e.jsxs(p.Item,{eventKey:"1",children:[e.jsx(p.Header,{children:"Informacion productos comprados"}),e.jsx(p.Body,{children:e.jsxs(G,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Talle"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"IMG"})]})}),s.map((r,c)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("td",{children:c+1}),e.jsx("td",{children:r.name}),e.jsxs("td",{children:["$ ",r.discountPrice||r.discountPrice>0?r.discountPrice:r.price]}),e.jsx("td",{children:r.size}),e.jsx("td",{children:r.amountToBuy}),e.jsx("td",{children:a(r)}),e.jsx("td",{children:e.jsx("img",{src:r.img,alt:"",className:"small-img-admin"})})]})},c))]})})]}),e.jsxs(p.Item,{eventKey:"2",children:[e.jsx(p.Header,{children:"Estado comprobante"}),e.jsxs(p.Body,{children:[e.jsxs("div",{style:{padding:"10px"},children:["Estado actual:",t.item.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green",marginLeft:"10px"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red",marginLeft:"10px"}})]}),e.jsx("button",{className:"btn btn-success",onClick:()=>d(!0),style:{marginRight:"10px"},children:"Confirmar que se subio el comprobante"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>d(!1),children:"Indicar que no se subio el comprobante"})]})]})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total:"})," $",R(t.item.totalPricePurchased||0)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",t.item.time]})]})]}),e.jsx(w.Footer,{children:e.jsx(k,{variant:"secondary",onClick:t.onHide,children:"Cerrar"})})]})},ie=({purchasedProducts:t,setPurchasedProducts:s,everyProductsRef:n,onPageChange:o})=>{const u=Z(),d=L(h=>h.filter.search.toLowerCase()),[a,r]=l.useState(""),c=h=>{const g=h.target.value;g.startsWith(" ")||(r(g),u(se(g)))},j=async()=>{d!==""?(s(n.filter(h=>h.operationCode.toLowerCase().includes(d.toLowerCase())||h.clientData.fullName.toLowerCase().includes(d.toLowerCase())||h.time.toLowerCase().includes(d.toLowerCase()))),o(1)):f()},f=async()=>{r(""),s(await A.getAll())};return e.jsxs(E,{className:"d-flex",fixed:"right",style:{marginLeft:"auto",flexDirection:"column"},children:[e.jsxs("div",{className:"d-flex",style:{},children:[e.jsx(E.Control,{type:"search",placeholder:"buscar por codigo, cliente, fecha...",className:"me-2","aria-label":"Search",onChange:c,value:a}),e.jsx(k,{onClick:()=>j(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(ee,{})}),e.jsx(k,{onClick:()=>f(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(te,{width:"18px",height:"18px"})})]}),e.jsxs("label",{style:{fontSize:"14px",padding:"3px"},children:[t==null?void 0:t.length," resultados de ",n.length]})]})},fe=()=>{var T;const t=L(i=>i.login),s=oe(),[n,o]=l.useState([]),u=l.useRef([]),[d,a]=l.useState(!1),[r,c]=l.useState({clientData:{fullName:"",email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""}}),[j,f]=l.useState(1),h=8,g=n.length,B=Math.ceil(g/h);l.useEffect(()=>{const i=async()=>{const m=await A.getAll(),x=U(m);o(x),u.current=x};console.log("entre"),i()},[]);const N=i=>{a(!0),c(i)},D=i=>{f(i)},V=()=>{const i=(j-1)*h,m=i+h;return n.slice(i,m)},_=i=>{b.fire({title:"Estas segura que queres eliminar el registro?",text:`codigo de operacion: ${i.operationCode}`,icon:"question",confirmButtonText:"Aceptar",confirmButtonColor:"#000",showDenyButton:!0,denyButtonText:"Cancelar"}).then(async m=>{if(m.isConfirmed)try{const x=re(t.token);await A.deletePurchase(i.id,x),b.fire({title:"Eliminado correctamente!",icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(()=>{H(.5)})}catch(x){console.error("Error",x),x.response.data.error==="token expired"?b.fire({title:"Se cerro tu sesion!",text:"Deberas iniciar sesion nuevamente",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(y=>{y.isConfirmed&&s("/login")}):(console.log(x),b.fire({title:"Error inesperado",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}))}})},$=i=>{const m=i.replace(/\s+/g," ").replace(/ a\. m\./i,"AM").replace(/ p\. m\./i,"PM"),[x]=m.split(", "),[y,J,Q]=x.split("/").map(Number);return new Date(Q,J-1,y)},U=(i,m)=>i.sort((x,y)=>$(y.time)-$(x.time)),W=i=>{let m=0,x=0;return i.cartPurchased.map(y=>{y.table=="primaria"?m++:y.table=="nivel_inicial"&&x++}),m==0&&x==0};return e.jsx("div",{children:e.jsxs("div",{className:"contenedor-tablas-productos",children:[e.jsx("h3",{children:"Historial de ventas"}),e.jsxs("div",{className:"d-flex gap-2 w-100",style:{marginLeft:"7%",alignItems:"center",marginBottom:"20px"},children:[e.jsx("div",{style:{backgroundColor:"#eed6e5",width:"40px",height:"20px",borderRadius:"8px"}}),e.jsx("p",{style:{fontSize:"13px",margin:"0px"},children:"Guardapolvos comprados del stock"})]}),e.jsxs("div",{className:"filters-table-container",children:[e.jsx(ie,{purchasedProducts:n,setPurchasedProducts:o,everyProductsRef:u.current,onPageChange:D}),e.jsx("div",{className:"contenedor-tabla",children:e.jsxs(G,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{className:"hide-on-mobile",children:"Codigo de operacion"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Total Compra"}),e.jsx("th",{className:"hide-on-mobile",children:"Fecha de compra"}),e.jsx("th",{children:"Comprobante"}),e.jsx("th",{children:"*"}),e.jsx("th",{children:"*"})]})}),(T=V())==null?void 0:T.map((i,m)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",style:W(i)?{backgroundColor:"#fbe6f3"}:null,children:[e.jsx("td",{children:m+1}),e.jsx("td",{className:"hide-on-mobile",children:i.operationCode}),e.jsx("td",{children:i.clientData.fullName}),e.jsxs("td",{children:["$ ",R(i.totalPricePurchased)]}),e.jsx("td",{className:"hide-on-mobile",children:i.time}),e.jsx("td",{children:i.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red"}})}),e.jsx("td",{onClick:()=>N(i),style:{cursor:"pointer",textDecoration:"underline"},children:"ver detalle"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>_(i),className:"boton-eliminar",style:{backgroundColor:"transparent"},children:e.jsx("i",{className:"fas fa-trash-alt"})})})]})},m))]})}),e.jsx(ne,{currentPage:j,totalPages:B,onPageChange:D})]}),e.jsx(ce,{item:r,show:d,onHide:()=>a(!1)})]})})};export{fe as default};
