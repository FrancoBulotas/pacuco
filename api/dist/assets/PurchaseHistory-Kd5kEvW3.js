import{r as i,i as g,j as e,ac as W,k as C,m as J,f as E,a4 as k,S as v,x as R,u as Q,b as H,w as T,ad as X,ae as Y,af as Z,ag as L,a as ee}from"./index-BpBHcA9P.js";import{p as A}from"./purchasedProduct-RLeIjXoq.js";import{M as N}from"./Modal-B44vx3an.js";/* empty css                       */import{s as te}from"./token-By_1sbaR.js";import{P as se}from"./PaginationProductos-BWYn-riT.js";function z(t,s){return Array.isArray(t)?t.includes(s):t===s}const w=i.createContext({});w.displayName="AccordionContext";const I=i.forwardRef(({as:t="div",bsPrefix:s,className:n,children:o,eventKey:h,...l},a)=>{const{activeEventKey:r}=i.useContext(w);return s=g(s,"accordion-collapse"),e.jsx(W,{ref:a,in:z(r,h),...l,className:C(n,s),children:e.jsx(t,{children:i.Children.only(o)})})});I.displayName="AccordionCollapse";const S=i.createContext({eventKey:""});S.displayName="AccordionItemContext";const F=i.forwardRef(({as:t="div",bsPrefix:s,className:n,onEnter:o,onEntering:h,onEntered:l,onExit:a,onExiting:r,onExited:c,...j},x)=>{s=g(s,"accordion-body");const{eventKey:d}=i.useContext(S);return e.jsx(I,{eventKey:d,onEnter:o,onEntering:h,onEntered:l,onExit:a,onExiting:r,onExited:c,children:e.jsx(t,{ref:x,...j,className:C(n,s)})})});F.displayName="AccordionBody";function oe(t,s){const{activeEventKey:n,onSelect:o,alwaysOpen:h}=i.useContext(w);return l=>{let a=t===n?null:t;h&&(Array.isArray(n)?n.includes(t)?a=n.filter(r=>r!==t):a=[...n,t]:a=[t]),o==null||o(a,l),s==null||s(l)}}const M=i.forwardRef(({as:t="button",bsPrefix:s,className:n,onClick:o,...h},l)=>{s=g(s,"accordion-button");const{eventKey:a}=i.useContext(S),r=oe(a,o),{activeEventKey:c}=i.useContext(w);return t==="button"&&(h.type="button"),e.jsx(t,{ref:l,onClick:r,...h,"aria-expanded":Array.isArray(c)?c.includes(a):a===c,className:C(n,s,!z(c,a)&&"collapsed")})});M.displayName="AccordionButton";const q=i.forwardRef(({as:t="h2",bsPrefix:s,className:n,children:o,onClick:h,...l},a)=>(s=g(s,"accordion-header"),e.jsx(t,{ref:a,...l,className:C(n,s),children:e.jsx(M,{onClick:h,children:o})})));q.displayName="AccordionHeader";const K=i.forwardRef(({as:t="div",bsPrefix:s,className:n,eventKey:o,...h},l)=>{s=g(s,"accordion-item");const a=i.useMemo(()=>({eventKey:o}),[o]);return e.jsx(S.Provider,{value:a,children:e.jsx(t,{ref:l,...h,className:C(n,s)})})});K.displayName="AccordionItem";const O=i.forwardRef((t,s)=>{const{as:n="div",activeKey:o,bsPrefix:h,className:l,onSelect:a,flush:r,alwaysOpen:c,...j}=J(t,{activeKey:"onSelect"}),x=g(h,"accordion"),d=i.useMemo(()=>({activeEventKey:o,onSelect:a,alwaysOpen:c}),[o,a,c]);return e.jsx(w.Provider,{value:d,children:e.jsx(n,{ref:s,...j,className:C(l,x,r&&`${x}-flush`)})})});O.displayName="Accordion";const p=Object.assign(O,{Button:M,Collapse:I,Item:K,Header:q,Body:F}),G=i.forwardRef(({bsPrefix:t,className:s,striped:n,bordered:o,borderless:h,hover:l,size:a,variant:r,responsive:c,...j},x)=>{const d=g(t,"table"),y=C(s,d,r&&`${d}-${r}`,a&&`${d}-${a}`,n&&`${d}-${typeof n=="string"?`striped-${n}`:"striped"}`,o&&`${d}-bordered`,h&&`${d}-borderless`,l&&`${d}-hover`),P=e.jsx("table",{...j,className:y,ref:x});if(c){let b=`${d}-responsive`;return typeof c=="string"&&(b=`${b}-${c}`),e.jsx("div",{className:b,children:P})}return P}),re=t=>{const[s,n]=i.useState([]),[o,h]=i.useState({fullName:t.item.clientData.fullName,email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""});i.useEffect(()=>{t.show&&(h(t.item.clientData),n(t.item.cartPurchased))},[t.show]);const l=async r=>{try{await A.update(t.item.id,{saleConfirmed:r}),v.fire({title:"Modificado correctamente!",text:`Modificaste el estado de: ${t.item.operationCode}`,icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(c=>{c.isConfirmed&&R(.5)})}catch(c){console.log(c),v.fire({title:"No se pduo modificar",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"})}},a=r=>{let c="";return r.table==="stock"?c="Stock":r.table==="primaria"?c="Primaria":r.table==="nivel_inicial"&&(c="Nivel Inicial"),c};return e.jsxs(N,{...t,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e.jsx(N.Header,{closeButton:!0,children:e.jsxs(N.Title,{id:"contained-modal-title-vcenter",children:["Detalle de operacion: ",t.item.operationCode]})}),e.jsxs(N.Body,{children:[e.jsxs(p,{children:[e.jsxs(p.Item,{eventKey:"0",children:[e.jsx(p.Header,{children:"Informacion del cliente"}),e.jsxs(p.Body,{children:[e.jsxs("div",{children:["Nombre: ",o.fullName]}),e.jsxs("div",{children:["Mail: ",o.email]}),e.jsxs("div",{children:["DNI: ",o.dni]}),e.jsxs("div",{children:["Telefono: ",o.phone]}),e.jsxs("div",{children:["Provincia: ",o.province]}),e.jsxs("div",{children:["Ciudad: ",o.city]}),e.jsxs("div",{children:["Direccion: ",o.address]}),e.jsxs("div",{children:["Codigo Postal: ",o.zipCode]}),e.jsxs("div",{children:["Metodo de pago: ",o.paymentMethod]}),e.jsxs("div",{children:["Metodo de envio: ",o.shipMethod]}),e.jsxs("div",{children:["Sucursal: ",o.sucursal!==""?o.sucursal:"ninguna"]})]})]}),e.jsxs(p.Item,{eventKey:"1",children:[e.jsx(p.Header,{children:"Informacion productos comprados"}),e.jsx(p.Body,{children:e.jsxs(G,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Talle"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"IMG"})]})}),s.map((r,c)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("td",{children:c+1}),e.jsx("td",{children:r.name}),e.jsxs("td",{children:["$ ",r.discountPrice||r.discountPrice>0?r.discountPrice:r.price]}),e.jsx("td",{children:r.size}),e.jsx("td",{children:r.amountToBuy}),e.jsx("td",{children:a(r)}),e.jsx("td",{children:e.jsx("img",{src:r.img,alt:"",className:"small-img-admin"})})]})},c))]})})]}),e.jsxs(p.Item,{eventKey:"2",children:[e.jsx(p.Header,{children:"Estado comprobante"}),e.jsxs(p.Body,{children:[e.jsxs("div",{style:{padding:"10px"},children:["Estado actual:",t.item.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green",marginLeft:"10px"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red",marginLeft:"10px"}})]}),e.jsx("button",{className:"btn btn-success",onClick:()=>l(!0),style:{marginRight:"10px"},children:"Confirmar que se subio el comprobante"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>l(!1),children:"Indicar que no se subio el comprobante"})]})]})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total:"})," $",E(t.item.totalPricePurchased||0)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",t.item.time]})]})]}),e.jsx(N.Footer,{children:e.jsx(k,{variant:"secondary",onClick:t.onHide,children:"Cerrar"})})]})},ne=({purchasedProducts:t,setPurchasedProducts:s,everyProductsRef:n,onPageChange:o})=>{const h=Q(),l=H(d=>d.filter.search.toLowerCase()),[a,r]=i.useState(""),c=d=>{const y=d.target.value;y.startsWith(" ")||(r(y),h(Z(y)))},j=async()=>{l!==""?(s(n.filter(d=>d.operationCode.toLowerCase().includes(l.toLowerCase())||d.clientData.fullName.toLowerCase().includes(l.toLowerCase())||d.time.toLowerCase().includes(l.toLowerCase()))),o(1)):x()},x=async()=>{r(""),s(L(await A.getAll()))};return e.jsxs(T,{className:"d-flex",fixed:"right",style:{marginLeft:"auto",flexDirection:"column"},children:[e.jsxs("div",{className:"d-flex",style:{},children:[e.jsx(T.Control,{type:"search",placeholder:"buscar por codigo, cliente, fecha...",className:"me-2","aria-label":"Search",onChange:c,value:a}),e.jsx(k,{onClick:()=>j(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(X,{})}),e.jsx(k,{onClick:()=>x(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(Y,{width:"18px",height:"18px"})})]}),e.jsxs("label",{style:{fontSize:"14px",padding:"3px"},children:[t==null?void 0:t.length," resultados de ",n.length]})]})},ue=()=>{var D;const t=H(u=>u.login),s=ee(),[n,o]=i.useState([]),h=i.useRef([]),[l,a]=i.useState(!1),[r,c]=i.useState({clientData:{fullName:"",email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""}}),[j,x]=i.useState(1),d=7,y=n.length,P=Math.ceil(y/d);i.useEffect(()=>{(async()=>{const m=await A.getAll(),f=L(m);o(f),h.current=f})()},[]);const b=u=>{a(!0),c(u)},$=u=>{x(u)},V=()=>{const u=(j-1)*d,m=u+d;return n.slice(u,m)},_=u=>{v.fire({title:"Estas segura que queres eliminar el registro?",text:`codigo de operacion: ${u.operationCode}`,icon:"question",confirmButtonText:"Aceptar",confirmButtonColor:"#000",showDenyButton:!0,denyButtonText:"Cancelar"}).then(async m=>{if(m.isConfirmed)try{const f=te(t.token);await A.deletePurchase(u.id,f),v.fire({title:"Eliminado correctamente!",icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(()=>{R(.5)})}catch(f){console.error("Error",f),f.response.data.error==="token expired"?v.fire({title:"Se cerro tu sesion!",text:"Deberas iniciar sesion nuevamente",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(B=>{B.isConfirmed&&s("/login")}):(console.log(f),v.fire({title:"Error inesperado",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}))}})},U=u=>{let m=0,f=0;return u.cartPurchased.map(B=>{B.table=="primaria"?m++:B.table=="nivel_inicial"&&f++}),m==0&&f==0};return e.jsx("div",{children:e.jsxs("div",{className:"contenedor-tablas-productos",children:[e.jsx("h3",{children:"Historial de ventas"}),e.jsxs("div",{className:"d-flex gap-2 w-100",style:{marginLeft:"7%",alignItems:"center",marginBottom:"20px"},children:[e.jsx("div",{style:{backgroundColor:"#eed6e5",width:"40px",height:"20px",borderRadius:"8px"}}),e.jsx("p",{style:{fontSize:"13px",margin:"0px"},children:"Guardapolvos comprados del stock"})]}),e.jsxs("div",{className:"filters-table-container",children:[e.jsx(ne,{purchasedProducts:n,setPurchasedProducts:o,everyProductsRef:h.current,onPageChange:$}),e.jsx("div",{className:"contenedor-tabla",children:e.jsxs(G,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{className:"hide-on-mobile",children:"Codigo de operacion"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{className:"hide-on-mobile",children:"Total Compra"}),e.jsx("th",{children:"Fecha de compra"}),e.jsx("th",{children:"Comprobante"}),e.jsx("th",{children:"*"}),e.jsx("th",{children:"*"})]})}),(D=V())==null?void 0:D.map((u,m)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",style:U(u)?{backgroundColor:"#fbe6f3"}:null,children:[e.jsx("td",{children:m+1}),e.jsx("td",{className:"hide-on-mobile",children:u.operationCode}),e.jsx("td",{children:u.clientData.fullName}),e.jsxs("td",{className:"hide-on-mobile",children:["$ ",E(u.totalPricePurchased)]}),e.jsx("td",{children:u.time.split(",")[0]}),e.jsx("td",{children:u.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red"}})}),e.jsx("td",{onClick:()=>b(u),style:{cursor:"pointer",textDecoration:"underline"},children:"ver detalle"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>_(u),className:"boton-eliminar",style:{backgroundColor:"transparent"},children:e.jsx("i",{className:"fas fa-trash-alt"})})})]})},m))]})}),e.jsx(se,{currentPage:j,totalPages:P,onPageChange:$})]}),e.jsx(re,{item:r,show:l,onHide:()=>a(!1)})]})})};export{ue as default};
