import{r as d,b as q,d as K,j as e,a as E,ai as L,X as B,S as b,u as G,i as H,W as M,aj as W,ak as _,a5 as X,al as S}from"./index-D8dEsisI.js";import{p as N}from"./purchasedProduct-BrqgUuhe.js";import{g as A}from"./guardapolvos-Dk_qiJgu.js";import{M as v,A as x}from"./Modal-OL2MqpvZ.js";/* empty css                       */import{s as J}from"./token-By_1sbaR.js";import{P as O}from"./PaginationProductos-BCASw6MW.js";const R=d.forwardRef(({bsPrefix:r,className:j,striped:i,bordered:o,borderless:f,hover:c,size:u,variant:m,responsive:t,...a},g)=>{const n=q(r,"table"),p=K(j,n,m&&`${n}-${m}`,u&&`${n}-${u}`,i&&`${n}-${typeof i=="string"?`striped-${i}`:"striped"}`,o&&`${n}-bordered`,f&&`${n}-borderless`,c&&`${n}-hover`),P=e.jsx("table",{...a,className:p,ref:g});if(t){let C=`${n}-responsive`;return typeof t=="string"&&(C=`${C}-${t}`),e.jsx("div",{className:C,children:P})}return P}),Q=r=>{E();const[j,i]=d.useState([]),[o,f]=d.useState({fullName:r.item.clientData.fullName,email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""});d.useEffect(()=>{r.show&&(f(r.item.clientData),i(r.item.cartPurchased))},[r.show]);const c=async t=>{try{await N.update(r.item.id,{saleConfirmed:t}),b.fire({title:"Modificado correctamente!",text:`Modificaste el estado de: ${r.item.operationCode}`,icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(a=>{a.isConfirmed&&(r.resetProducts(),r.onHide())})}catch(a){console.log(a),b.fire({title:"No se pduo modificar",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"})}},u=t=>{let a="";return t.table==="stock"?a="Stock":t.table==="primaria"?a="Primaria":t.table==="nivel_inicial"&&(a="Nivel Inicial"),a},m=t=>{const a=`/products?id=${t.id}`;window.open(a,"_blank")};return e.jsxs(v,{...r,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e.jsx(v.Header,{closeButton:!0,children:e.jsxs(v.Title,{id:"contained-modal-title-vcenter",children:["Detalle de operacion: ",r.item.operationCode]})}),e.jsxs(v.Body,{children:[e.jsxs(x,{children:[e.jsxs(x.Item,{eventKey:"0",children:[e.jsx(x.Header,{children:e.jsx("strong",{children:"Informacion del cliente"})}),e.jsxs(x.Body,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Nombre:"})," ",o.fullName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Mail:"})," ",o.email]}),e.jsxs("div",{children:[e.jsx("strong",{children:"DNI:"})," ",o.dni]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Telefono:"})," ",o.phone]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Provincia:"})," ",o.province]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ciudad:"})," ",o.city]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Direccion:"})," ",o.address]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Codigo Postal:"})," ",o.zipCode]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Metodo de pago:"})," ",o.paymentMethod]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Metodo de envio:"})," ",o.shipMethod]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Sucursal:"})," ",o.sucursal!==""?o.sucursal:"ninguna"]})]})]}),e.jsxs(x.Item,{eventKey:"1",children:[e.jsx(x.Header,{children:e.jsx("strong",{children:"Informacion productos comprados"})}),e.jsx(x.Body,{children:e.jsxs(R,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Talle"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"IMG"})]})}),j.map((t,a)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",onClick:()=>m(t),style:{cursor:"pointer"},children:[e.jsx("td",{children:t.name}),e.jsxs("td",{children:["$ ",t.discountPrice||t.discountPrice>0?t.discountPrice:t.price]}),e.jsx("td",{children:t.size}),e.jsx("td",{children:t.amountToBuy}),e.jsx("td",{children:u(t)}),e.jsx("td",{children:e.jsx("img",{src:t.img,alt:t.description.general,className:"small-img-admin"})})]})},a))]})})]}),e.jsxs(x.Item,{eventKey:"2",children:[e.jsx(x.Header,{children:e.jsx("strong",{children:"Estado comprobante"})}),e.jsxs(x.Body,{children:[e.jsxs("div",{style:{padding:"10px"},children:["Estado actual:",r.item.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green",marginLeft:"10px"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red",marginLeft:"10px"}})]}),e.jsx("button",{className:"btn btn-success",onClick:()=>c(!0),style:{marginRight:"10px"},children:"Confirmar que se subio el comprobante"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>c(!1),children:"Indicar que no se subio el comprobante"})]})]})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total:"})," $",L(r.item.totalPricePurchased||0)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",r.item.time]})]})]}),e.jsx(v.Footer,{children:e.jsx(B,{variant:"secondary",onClick:r.onHide,children:"Cerrar"})})]})},U=({purchasedProducts:r,setPurchasedProducts:j,everyProductsRef:i,onPageChange:o})=>{const f=G(),c=H(n=>n.filter.search.toLowerCase()),[u,m]=d.useState(""),t=n=>{const p=n.target.value;p.startsWith(" ")||(m(p),f(X(p)))},a=async()=>{c!==""?(j(i.filter(n=>n.operationCode.toLowerCase().includes(c.toLowerCase())||n.clientData.fullName.toLowerCase().includes(c.toLowerCase())||n.time.toLowerCase().includes(c.toLowerCase()))),o(1)):g()},g=async()=>{m(""),j(S(await N.getAll()))};return e.jsxs(M,{className:"d-flex",fixed:"right",style:{marginLeft:"auto",flexDirection:"column"},children:[e.jsxs("div",{className:"d-flex",style:{},children:[e.jsx(M.Control,{type:"search",placeholder:"buscar por codigo, cliente, fecha...",className:"me-2","aria-label":"Search",onChange:t,value:u}),e.jsx(B,{onClick:()=>a(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(W,{})}),e.jsx(B,{onClick:()=>g(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(_,{width:"18px",height:"18px"})})]}),e.jsxs("label",{style:{fontSize:"14px",padding:"3px"},children:[r==null?void 0:r.length," resultados de ",i.length]})]})},oe=()=>{var $;const r=H(s=>s.login),j=E(),[i,o]=d.useState([]),f=d.useRef([]),[c,u]=d.useState(!1),[m,t]=d.useState({clientData:{fullName:"",email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""}}),[a,g]=d.useState(1),n=7,p=i.length,P=Math.ceil(p/n);d.useEffect(()=>{(async()=>{const l=await N.getAll(),h=S(l);o(h),f.current=h})()},[]);const C=s=>{u(!0),t(s)},T=s=>{g(s)},z=()=>{const s=(a-1)*n,l=s+n;return i.slice(s,l)},I=async()=>{o(S(await N.getAll()))},F=s=>{b.fire({title:"Estas segura que queres eliminar el registro?",text:`codigo de operacion: ${s.operationCode}`,icon:"question",confirmButtonText:"Aceptar",confirmButtonColor:"#000",showDenyButton:!0,denyButtonText:"Cancelar",html:`${k(s)?`
                    <div style="text-align: left;">
                        <input type="checkbox" id="confirmCheckbox">
                        <label for="confirmCheckbox">Agregar nuevamente los guardapolvos al stock</label>
                    </div>
                    `:""} `}).then(async l=>{if(l.isConfirmed)try{if(k(s)&&document.getElementById("confirmCheckbox").checked)try{s.cartPurchased.forEach(async y=>{if(y.table==="stock"){const w=await A.getById(y.id);await A.update(w.id,{...w,amountToBuy:1,amount:w.amount+y.amountToBuy})}})}catch(y){console.log(y)}const h=J(r.token);await N.deletePurchase(s.id,h),b.fire({title:"Eliminado correctamente!",icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(()=>{I()})}catch(h){console.error("Error",h),h.response.data.error==="token expired"?b.fire({title:"Se cerro tu sesion!",text:"Deberas iniciar sesion nuevamente",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(D=>{D.isConfirmed&&j("/login")}):(console.log(h),b.fire({title:"Error inesperado",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}))}})},k=s=>{let l=0;return s.cartPurchased.map(h=>{h.table=="stock"&&l++}),l>0};return e.jsx("div",{children:e.jsxs("div",{className:"contenedor-tablas-productos",children:[e.jsx("h3",{children:"Historial de ventas"}),e.jsxs("div",{className:"d-flex gap-2 w-100",style:{marginLeft:"7%",alignItems:"center",marginBottom:"20px"},children:[e.jsx("div",{style:{backgroundColor:"#eed6e5",width:"40px",height:"20px",borderRadius:"8px"}}),e.jsx("p",{style:{fontSize:"13px",margin:"0px"},children:"Guardapolvos comprados del stock"})]}),e.jsxs("div",{className:"filters-table-container",children:[e.jsx(U,{purchasedProducts:i,setPurchasedProducts:o,everyProductsRef:f.current,onPageChange:T}),e.jsx("div",{className:"contenedor-tabla",children:e.jsxs(R,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{className:"hide-on-mobile",children:"Codigo de operacion"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{className:"hide-on-mobile",children:"Total Compra"}),e.jsx("th",{children:"Fecha de compra"}),e.jsx("th",{children:"Comprobante"}),e.jsx("th",{children:"*"}),e.jsx("th",{children:"*"})]})}),($=z())==null?void 0:$.map((s,l)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",style:k(s)?{backgroundColor:"#fbe6f3"}:null,children:[e.jsx("td",{children:l+1}),e.jsx("td",{className:"hide-on-mobile",children:s.operationCode}),e.jsx("td",{children:s.clientData.fullName}),e.jsxs("td",{className:"hide-on-mobile",children:["$ ",L(s.totalPricePurchased)]}),e.jsx("td",{children:s.time.split(",")[0]}),e.jsx("td",{children:s.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red"}})}),e.jsx("td",{onClick:()=>C(s),style:{cursor:"pointer",textDecoration:"underline"},children:"ver detalle"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>F(s),className:"boton-eliminar",style:{backgroundColor:"transparent"},children:e.jsx("i",{className:"fas fa-trash-alt"})})})]})},l))]})}),e.jsx(O,{currentPage:a,totalPages:P,onPageChange:T})]}),e.jsx(Q,{item:m,show:c,onHide:()=>u(!1),resetProducts:I})]})})};export{oe as default};
