import{r as d,t as p,j as e,ab as W,v as C,M as _,ac as k,G as D,S as v,K as E,u as U,E as L,F as $,ad as J,_ as Q,b as X}from"./index-D08S3TCd.js";import{p as A}from"./purchasedProduct-UEgyI22Q.js";import{M as b}from"./Modal-CQ6PXwu1.js";/* empty css                       */import{s as Y}from"./token-By_1sbaR.js";import{P as Z}from"./PaginationProductos-lDlKcv9f.js";function H(t,o){return Array.isArray(t)?t.includes(o):t===o}const N=d.createContext({});N.displayName="AccordionContext";const S=d.forwardRef(({as:t="div",bsPrefix:o,className:n,children:s,eventKey:l,...u},c)=>{const{activeEventKey:r}=d.useContext(N);return o=p(o,"accordion-collapse"),e.jsx(W,{ref:c,in:H(r,l),...u,className:C(n,o),children:e.jsx(t,{children:d.Children.only(s)})})});S.displayName="AccordionCollapse";const B=d.createContext({eventKey:""});B.displayName="AccordionItemContext";const R=d.forwardRef(({as:t="div",bsPrefix:o,className:n,onEnter:s,onEntering:l,onEntered:u,onExit:c,onExiting:r,onExited:a,...m},h)=>{o=p(o,"accordion-body");const{eventKey:i}=d.useContext(B);return e.jsx(S,{eventKey:i,onEnter:s,onEntering:l,onEntered:u,onExit:c,onExiting:r,onExited:a,children:e.jsx(t,{ref:h,...m,className:C(n,o)})})});R.displayName="AccordionBody";function ee(t,o){const{activeEventKey:n,onSelect:s,alwaysOpen:l}=d.useContext(N);return u=>{let c=t===n?null:t;l&&(Array.isArray(n)?n.includes(t)?c=n.filter(r=>r!==t):c=[...n,t]:c=[t]),s==null||s(c,u),o==null||o(u)}}const M=d.forwardRef(({as:t="button",bsPrefix:o,className:n,onClick:s,...l},u)=>{o=p(o,"accordion-button");const{eventKey:c}=d.useContext(B),r=ee(c,s),{activeEventKey:a}=d.useContext(N);return t==="button"&&(l.type="button"),e.jsx(t,{ref:u,onClick:r,...l,"aria-expanded":Array.isArray(a)?a.includes(c):c===a,className:C(n,o,!H(a,c)&&"collapsed")})});M.displayName="AccordionButton";const F=d.forwardRef(({as:t="h2",bsPrefix:o,className:n,children:s,onClick:l,...u},c)=>(o=p(o,"accordion-header"),e.jsx(t,{ref:c,...u,className:C(n,o),children:e.jsx(M,{onClick:l,children:s})})));F.displayName="AccordionHeader";const K=d.forwardRef(({as:t="div",bsPrefix:o,className:n,eventKey:s,...l},u)=>{o=p(o,"accordion-item");const c=d.useMemo(()=>({eventKey:s}),[s]);return e.jsx(B.Provider,{value:c,children:e.jsx(t,{ref:u,...l,className:C(n,o)})})});K.displayName="AccordionItem";const q=d.forwardRef((t,o)=>{const{as:n="div",activeKey:s,bsPrefix:l,className:u,onSelect:c,flush:r,alwaysOpen:a,...m}=_(t,{activeKey:"onSelect"}),h=p(l,"accordion"),i=d.useMemo(()=>({activeEventKey:s,onSelect:c,alwaysOpen:a}),[s,c,a]);return e.jsx(N.Provider,{value:i,children:e.jsx(n,{ref:o,...m,className:C(u,h,r&&`${h}-flush`)})})});q.displayName="Accordion";const f=Object.assign(q,{Button:M,Collapse:S,Item:K,Header:F,Body:R}),z=d.forwardRef(({bsPrefix:t,className:o,striped:n,bordered:s,borderless:l,hover:u,size:c,variant:r,responsive:a,...m},h)=>{const i=p(t,"table"),P=C(o,i,r&&`${i}-${r}`,c&&`${i}-${c}`,n&&`${i}-${typeof n=="string"?`striped-${n}`:"striped"}`,s&&`${i}-bordered`,l&&`${i}-borderless`,u&&`${i}-hover`),w=e.jsx("table",{...m,className:P,ref:h});if(a){let g=`${i}-responsive`;return typeof a=="string"&&(g=`${g}-${a}`),e.jsx("div",{className:g,children:w})}return w}),te=t=>{const[o,n]=d.useState([]),[s,l]=d.useState({fullName:t.item.clientData.fullName,email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""});d.useEffect(()=>{t.show&&(l(t.item.clientData),n(t.item.cartPurchased))},[t.show]);const u=async r=>{try{await A.update(t.item.id,{saleConfirmed:r}),v.fire({title:"Modificado correctamente!",text:`Modificaste el estado de: ${t.item.operationCode}`,icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(a=>{a.isConfirmed&&E(.5)})}catch(a){console.log(a),v.fire({title:"No se pduo modificar",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"})}},c=r=>{let a="";return r.table==="stock"?a="Stock":r.table==="primaria"?a="Primaria":r.table==="nivel_inicial"&&(a="Nivel Inicial"),a};return e.jsxs(b,{...t,size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0,children:[e.jsx(b.Header,{closeButton:!0,children:e.jsxs(b.Title,{id:"contained-modal-title-vcenter",children:["Detalle de operacion: ",t.item.operationCode]})}),e.jsxs(b.Body,{children:[e.jsxs(f,{children:[e.jsxs(f.Item,{eventKey:"0",children:[e.jsx(f.Header,{children:"Informacion del cliente"}),e.jsxs(f.Body,{children:[e.jsxs("div",{children:["Nombre: ",s.fullName]}),e.jsxs("div",{children:["Mail: ",s.email]}),e.jsxs("div",{children:["DNI: ",s.dni]}),e.jsxs("div",{children:["Telefono: ",s.phone]}),e.jsxs("div",{children:["Provincia: ",s.province]}),e.jsxs("div",{children:["Ciudad: ",s.city]}),e.jsxs("div",{children:["Direccion: ",s.address]}),e.jsxs("div",{children:["Codigo Postal: ",s.zipCode]}),e.jsxs("div",{children:["Metodo de pago: ",s.paymentMethod]}),e.jsxs("div",{children:["Metodo de envio: ",s.shipMethod]}),e.jsxs("div",{children:["Sucursal: ",s.sucursal!==""?s.sucursal:"ninguna"]})]})]}),e.jsxs(f.Item,{eventKey:"1",children:[e.jsx(f.Header,{children:"Informacion productos comprados"}),e.jsx(f.Body,{children:e.jsxs(z,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Talle"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"IMG"})]})}),o.map((r,a)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:r.name}),e.jsxs("td",{children:["$ ",r.discountPrice||r.discountPrice>0?r.discountPrice:r.price]}),e.jsx("td",{children:r.size}),e.jsx("td",{children:r.amountToBuy}),e.jsx("td",{children:c(r)}),e.jsx("td",{children:e.jsx("img",{src:r.img,alt:"",className:"small-img-admin"})})]})},a))]})})]}),e.jsxs(f.Item,{eventKey:"2",children:[e.jsx(f.Header,{children:"Estado comprobante"}),e.jsxs(f.Body,{children:[e.jsxs("div",{style:{padding:"10px"},children:["Estado actual:",t.item.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green",marginLeft:"10px"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red",marginLeft:"10px"}})]}),e.jsx("button",{className:"btn btn-success",onClick:()=>u(!0),style:{marginRight:"10px"},children:"Confirmar que se subio el comprobante"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>u(!1),children:"Indicar que no se subio el comprobante"})]})]})]}),e.jsxs("div",{style:{padding:"20px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total:"})," $",k(t.item.totalPricePurchased||0)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",t.item.time]})]})]}),e.jsx(b.Footer,{children:e.jsx(D,{variant:"secondary",onClick:t.onHide,children:"Cerrar"})})]})};var se=oe;function oe(t,o,n){var s=null,l=null,u=function(){s&&(clearTimeout(s),l=null,s=null)},c=function(){var a=l;u(),a&&a()},r=function(){if(!o)return t.apply(this,arguments);var a=this,m=arguments,h=n&&!s;if(u(),l=function(){t.apply(a,m)},s=setTimeout(function(){if(s=null,!h){var i=l;return l=null,i()}},o),h)return l()};return r.cancel=u,r.flush=c,r}const re=({purchasedProducts:t,setPurchasedProducts:o,everyProductsRef:n,onPageChange:s})=>{const l=U();L(h=>h.filter.search.toLowerCase());const[u,c]=d.useState(""),r=d.useCallback(se(h=>{h!==""?(console.log(n),console.log(n.filter(i=>i.operationCode.toLowerCase().includes(h.toLowerCase())||i.clientData.fullName.toLowerCase().includes(h.toLowerCase())||i.time.toLowerCase().includes(h.toLowerCase()))),o(n.filter(i=>i.operationCode.toLowerCase().includes(h.toLowerCase())||i.clientData.fullName.toLowerCase().includes(h.toLowerCase())||i.time.toLowerCase().includes(h.toLowerCase()))),s(1)):m()},400),[]),a=h=>{const i=h.target.value;i.startsWith(" ")||(c(i),l(Q(i)),r(i))},m=async()=>{o(await A.getAll())};return e.jsxs($,{className:"d-flex",fixed:"right",style:{marginLeft:"auto",flexDirection:"column"},children:[e.jsxs("div",{className:"d-flex",style:{},children:[e.jsx($.Control,{type:"search",placeholder:"buscar por codigo, cliente, fecha...",className:"me-2","aria-label":"Search",onChange:a,value:u}),e.jsx(D,{onClick:()=>m(),variant:"outline-secondary",style:{padding:"0px 10px 5px 10px"},children:e.jsx(J,{width:"18px",height:"18px"})})]}),e.jsxs("label",{style:{fontSize:"14px",padding:"3px"},children:[t==null?void 0:t.length," resultados de ",n.length]})]})},ue=()=>{var T;const t=L(x=>x.login),o=X(),[n,s]=d.useState([]),l=d.useRef([]),[u,c]=d.useState(!1),[r,a]=d.useState({clientData:{fullName:"",email:"",dni:"",phone:"",province:"",city:"",address:"",zipCode:"",paymentMethod:"",shipMethod:"",sucursal:""}}),[m,h]=d.useState(1),i=7,P=n.length,w=Math.ceil(P/i);d.useEffect(()=>{(async()=>{const j=await A.getAll();s(j),l.current=j})()},[]);const g=x=>{c(!0),a(x)},I=x=>{h(x)},O=()=>{const x=(m-1)*i,j=x+i;return n.slice(x,j)},G=x=>{v.fire({title:"Estas segura que queres eliminar el registro?",text:`codigo de operacion: ${x.operationCode}`,icon:"question",confirmButtonText:"Aceptar",confirmButtonColor:"#000",showDenyButton:!0,denyButtonText:"Cancelar"}).then(async j=>{if(j.isConfirmed)try{const y=Y(t.token);await A.deletePurchase(x.id,y),v.fire({title:"Eliminado correctamente!",icon:"success",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(()=>{E(.5)})}catch(y){console.error("Error",y),y.response.data.error==="token expired"?v.fire({title:"Se cerro tu sesion!",text:"Deberas iniciar sesion nuevamente",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}).then(V=>{V.isConfirmed&&o("/login")}):(console.log(y),v.fire({title:"Error inesperado",text:"Intentalo nuevamente mas tarde.",icon:"error",confirmButtonText:"Aceptar",confirmButtonColor:"#000"}))}})};return e.jsx("div",{children:e.jsxs("div",{className:"contenedor-tablas-productos",children:[e.jsx("h3",{children:"Historial de ventas"}),e.jsxs("div",{className:"filters-table-container",children:[e.jsx(re,{purchasedProducts:n,setPurchasedProducts:s,everyProductsRef:l.current,onPageChange:I}),e.jsx("div",{className:"contenedor-tabla",children:e.jsxs(z,{hover:!0,variant:"light",className:"tabla-de-productos",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Codigo de operacion"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Total Compra"}),e.jsx("th",{children:"Fecha de compra"}),e.jsx("th",{children:"Comprobante"}),e.jsx("th",{children:"*"}),e.jsx("th",{children:"*"})]})}),(T=O())==null?void 0:T.map((x,j)=>e.jsx("tbody",{children:e.jsxs("tr",{className:"tr-tabla-productos",children:[e.jsx("td",{children:j+1}),e.jsx("td",{children:x.operationCode}),e.jsx("td",{children:x.clientData.fullName}),e.jsxs("td",{children:["$ ",k(x.totalPricePurchased)]}),e.jsx("td",{children:x.time}),e.jsx("td",{children:x.saleConfirmed?e.jsx("i",{className:"bi bi-check-lg",style:{color:"green"}}):e.jsx("i",{className:"bi bi-x-lg",style:{color:"red"}})}),e.jsx("td",{onClick:()=>g(x),style:{cursor:"pointer",textDecoration:"underline"},children:"ver detalle"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>G(x),className:"boton-eliminar",style:{backgroundColor:"transparent"},children:e.jsx("i",{className:"fas fa-trash-alt"})})})]})},j))]})}),e.jsx(Z,{currentPage:m,totalPages:w,onPageChange:I})]}),e.jsx(te,{item:r,show:u,onHide:()=>c(!1)})]})})};export{ue as default};
